@model Observation
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager
@using Newtonsoft.Json

@{
    var conjugatedVerb = Model.Quantity > 1 ? "were" : "was";

    <div data-bind="html: Title()"></div>
    @*<div data-bind="html: SubTitle()"></div>*@

    if (Model.ApplicationUserId == UserManager.GetUserAsync(User).Result.Id)
    {
        <h4><b>@Model.Quantity</b> @conjugatedVerb spotted by <a asp-controller="User" asp-action="Details" asp-route-userName="@Model.ApplicationUser.UserName">You</a> on  @Model.ObservationDateTime.ToString("dddd, dd MMMM yyyy, HH:mm")</h4>
    }
    else
    {
        <h4><b>@Model.Quantity</b> @conjugatedVerb spotted by <a asp-controller="User" asp-action="Details" asp-route-userName="@Model.ApplicationUser.UserName">@Model.ApplicationUser.UserName</a> on @Html.DisplayFor(modelItem => Model.ObservationDateTime)</h4>
    };

    <p> Find out more about the <a asp-controller="Bird" asp-action="Details" asp-route-id="@Model.Bird.BirdId">@Model.Bird.EnglishName</a> and the details of other sightings of this species.</p>
}


<div>
    <div class="row">
        <div class="col-sm-4">
        </div>
        <div class="col-sm-8">
            <button class="btn btn-link" type="button" onclick="expand()" style="float: right;">Expand All</button>
            <button class="btn btn-link" type="button" onclick="collapse()" style="float: right;">Collapse All</button>
        </div>
    </div>

    <div class="panel-group" id="accordion">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" @*data-parent="#accordion" *@ href="#collapse1"><b>Photographs</b></a>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div class="box content">
                        <!-- <p><span id="gallery-note">Gallery refreshes from storage container image links every 5 seconds.</span></p> -->
                        <div id="stored-images"></div>
                        <!-- The Gallery as inline carousel, can be positioned anywhere on the page -->
                        <div id="blueimp-gallery-carousel" class="blueimp-gallery blueimp-gallery-carousel">
                            <div class="slides"></div>
                            <h3 class="title"></h3>
                            <a class="prev">‹</a>
                            <a class="next">›</a>
                            <a class="play-pause"></a>
                            <ol class="indicator"></ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" @*data-parent="#accordion" *@ href="#collapse2"><b>Upload photographs</b></a>
                </h4>
            </div>
            <div id="collapse2" class="panel-collapse collapse">
                <div class="panel-body">
                    <div>
                        <form action="/api/imagesapi/upload"
                              class="dropzone needsclick dz-clickable"
                              id="image-upload"
                              method="post"
                              enctype="multipart/form-data">
                            <div class="dz-message needsclick">
                                <span class="note needsclick">
                                    Drop photographs here or Click here to upload...
                                </span>
                            </div>
                            <div>
                                <input asp-for="ObservationId" class="form-control" data-bind="text: ObservationId" type="hidden" />
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" @*data-parent="#accordion" *@ href="#collapse3"><b>Notes</b></a>
                </h4>
            </div>
            <div id="collapse3" class="panel-collapse collapse">
                <div class="panel-body">
                    <label asp-for="NoteGeneral"></label>
                    <input asp-for="NoteGeneral" class="form-control" data-bind="text: NoteGeneral" disabled />
                    <br />
                    <label asp-for="NoteHabitat"></label>
                    <input asp-for="NoteHabitat" class="form-control" data-bind="text: NoteHabitat" disabled />
                    <br />
                    <label asp-for="NoteWeather"></label>
                    <input asp-for="NoteWeather" class="form-control" data-bind="text: NoteWeather" disabled />
                    <br />
                    <label asp-for="NoteAppearance"></label>
                    <input asp-for="NoteAppearance" class="form-control" data-bind="text: NoteAppearance" disabled />
                    <br />
                    <label asp-for="NoteVocalisation"></label>
                    <input asp-for="NoteVocalisation" class="form-control" data-bind="text: NoteVocalisation" disabled />
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" @*data-parent="#accordion" *@ href="#collapse4"><b>Location</b></a>
                </h4>
            </div>
            <div id="collapse4" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div id="map" class="class--map"></div>
                </div>
            </div>
        </div>
    </div>
</div>


@{
    if (Model.ApplicationUserId == UserManager.GetUserAsync(User).Result.Id)
    {
        <div>
            <a asp-action="Edit" asp-route-id="@Model.ObservationId" class="btn btn-link">Edit</a>
            <a asp-action="Delete" asp-route-id="@Model.ObservationId" class="btn btn-link">Delete</a>
            <a asp-action="Index" class="btn btn-link">Back to Observations feed</a>
        </div>
    }
    else
    {
        <div>
            <a asp-action="Index" class="btn btn-link">Back to List</a>
        </div>
    };
}


<small data-bind="text: RecordDates"></small>

@{
    ViewData["Title"] = "Observation Details";
    string data = JsonConvert.SerializeObject(Model,
        new JsonSerializerSettings()
        {
            ReferenceLoopHandling = ReferenceLoopHandling.Ignore
        });
}

@section scripts{
    <script src="~/js/jqueryvalidate.js"></script>
    <script src="~/js/jquery-validate.bootstrap-tooltip.js"></script>
    <script src="~/js/observationDetailsViewModel.js"></script>
    <script src="~/js/accordionHandler.js"></script>
    <script src="~/js/dropzoneConfiguration.js"></script>
    <script type="text/javascript">
        var observationDetailsViewModel = new ObservationDetailsViewModel(@Html.Raw(data));
        ko.applyBindings(observationDetailsViewModel);
    </script>
}
