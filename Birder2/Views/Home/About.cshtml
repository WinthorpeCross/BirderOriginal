@using FlickrNet
@model PhotoCollection

<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.2.0/knockout-min.js"></script>
<div data-bind="foreach: users">
    <input type="text" data-bind="value: name" />
    <input type="number" data-bind="value: qty" /><br />
</div>
<button data-bind="click: addUser">Add user</button>

<ul data-bind="foreach: users">
    <li data-bind="text: name"></li>
    <li data-bind="text: qty"></li>
</ul>

<script>

    var model = {
        users: ko.observableArray(),
        addUser: function () {
            this.users.push({ name: ko.observable() });
        }
    };

    ko.applyBindings(model);
</script>






<p id="latitude"></p>
<p id="longitude"></p>
<p id="location"></p>

<div class="container" id="floating-panel">
    <input id="address" type="text" value="search...">
    <input id="submit" type="button" value="Search">
</div>
<div id="map" class="class--map"></div>


<script>
    var markers = [];

    function initMap() {
        var myLatlng = new google.maps.LatLng(54.972237, -2.4608560000000352);
        var myOptions = {
            zoom: 13,
            center: myLatlng,
        }

        var map = new google.maps.Map(document.getElementById("map"), myOptions);
        var geocoder = new google.maps.Geocoder();

        //google.maps.event.addListenerOnce(map, 'idle', addMarker(myLatlng));
        google.maps.event.addListenerOnce(map, 'idle', function (event) {
            geocoder.geocode({
                'latLng': myLatlng
            }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        //alert(results[0].formatted_address);
                        document.getElementById('location').innerHTML = results[0].formatted_address;
                        addMarker(results[0].geometry.location);
                    }
                }
            });
        });

        document.getElementById('submit').addEventListener('click', function (event) {
            var address = document.getElementById('address').value;
            geocoder.geocode({
                'address': address
            }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        //alert(results[0].formatted_address);
                        document.getElementById('location').innerHTML = results[0].formatted_address;
                        addMarker(results[0].geometry.location);
                    }
                }
            });
        });

        google.maps.event.addListener(map, 'click', function (event) {
            geocoder.geocode({
                'latLng': event.latLng
            }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        //alert(results[0].formatted_address);
                        document.getElementById('location').innerHTML = results[0].formatted_address;
                        addMarker(event.latLng);
                    }
                }
            });
        });

        function addMarker(location) {
            var marker = new google.maps.Marker({
                position: location,
                map: map,
            });

            map.panTo(location);
            deleteMarkers();
            markers.push(marker);
            updateForm();
        }


        // Sets the map on all markers in the array.
        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

        // Removes the markers from the map, but keeps them in the array.
        function clearMarkers() {
            setMapOnAll(null);
        }

        // Shows any markers currently in the array.
        function showMarkers() {
            setMapOnAll(map);
        }

        // Deletes all markers in the array by removing references to them.
        function deleteMarkers() {
            clearMarkers();
            markers = [];
        }
        function updateForm() {
            document.getElementById('latitude').innerHTML = markers[0].position.lat();
            document.getElementById('longitude').innerHTML = markers[0].position.lng();
        }
    }

</script>

